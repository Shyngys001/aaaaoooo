<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATLAS Ultimate ‚Äî Premium Package Generator (Fully Editable)</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;600;700&family=Libre+Baskerville:wght@400;700&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --color-primary: #d4af37;
            --color-primary-dark: #b8941f;
            --color-secondary: #2c3e50;
            --color-text: #1a1a1a;
            --color-text-light: #6b7280;
            --color-bg: #f8f9fa;
            --color-white: #ffffff;
            --color-border: #e5e7eb;
            --color-error: #ef4444;
            --color-success: #10b981;
            
            --spacing-unit: 8px;
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
            
            --transition: all 0.2s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 14px;
            line-height: 1.6;
            color: var(--color-text);
            background: var(--color-bg);
            overflow-x: hidden;
        }
        
        /* === LAYOUT === */
        .app-container {
            display: flex;
            min-height: 100vh;
        }
        
        .editor-panel {
            width: 440px;
            background: var(--color-white);
            border-right: 1px solid var(--color-border);
            overflow-y: auto;
            position: sticky;
            top: 0;
            height: 100vh;
            z-index: 100;
        }
        
        .editor-header {
            padding: calc(var(--spacing-unit) * 3);
            border-bottom: 1px solid var(--color-border);
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
            color: var(--color-white);
        }
        
        .editor-header h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: calc(var(--spacing-unit) / 2);
        }
        
        .editor-header p {
            font-size: 13px;
            opacity: 0.9;
        }
        
        .editor-content {
            padding: calc(var(--spacing-unit) * 3);
        }
        
        .preview-container {
            flex: 1;
            padding: calc(var(--spacing-unit) * 4);
            overflow-y: auto;
            background: linear-gradient(to bottom, #f0f0f0 0%, #e8e8e8 100%);
        }
        
        #previewSheet {
            background: var(--color-white);
            box-shadow: var(--shadow-xl);
            margin: 0 auto;
            max-width: 1200px;
        }
        
        /* === FORM SECTIONS === */
        .form-section {
            margin-bottom: calc(var(--spacing-unit) * 4);
        }
        
        .section-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: calc(var(--spacing-unit) * 2);
            color: var(--color-secondary);
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-unit) * 1);
        }
        
        .section-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: linear-gradient(to bottom, var(--color-primary), var(--color-primary-dark));
            border-radius: 2px;
        }
        
        .form-group {
            margin-bottom: calc(var(--spacing-unit) * 2);
        }
        
        label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: calc(var(--spacing-unit) * 1);
            color: var(--color-text);
        }
        
        input[type="text"],
        input[type="number"],
        input[type="url"],
        textarea {
            width: 100%;
            padding: calc(var(--spacing-unit) * 1.5);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            font-family: inherit;
            font-size: 14px;
            transition: var(--transition);
        }
        
        input:focus,
        textarea:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }
        
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        /* === BUTTONS === */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: calc(var(--spacing-unit) * 1);
            padding: calc(var(--spacing-unit) * 1.5) calc(var(--spacing-unit) * 3);
            border: none;
            border-radius: var(--radius-md);
            font-family: inherit;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            min-height: 44px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
            color: var(--color-white);
            box-shadow: var(--shadow-md);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-primary:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: var(--color-white);
            color: var(--color-secondary);
            border: 2px solid var(--color-border);
        }
        
        .btn-secondary:hover {
            border-color: var(--color-primary);
            color: var(--color-primary);
        }
        
        .btn-small {
            padding: calc(var(--spacing-unit) * 1) calc(var(--spacing-unit) * 2);
            font-size: 13px;
            min-height: 36px;
        }
        
        .btn-icon {
            padding: calc(var(--spacing-unit) * 1);
            min-height: 36px;
            width: 36px;
        }
        
        .btn-delete {
            background: #fee;
            color: var(--color-error);
            border: 1px solid #fcc;
        }
        
        .btn-delete:hover {
            background: var(--color-error);
            color: white;
        }
        
        .button-group {
            display: flex;
            gap: calc(var(--spacing-unit) * 1.5);
            flex-wrap: wrap;
        }
        
        /* === LOGO UPLOAD === */
        .logo-upload {
            border: 2px dashed var(--color-border);
            border-radius: var(--radius-md);
            padding: calc(var(--spacing-unit) * 3);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .logo-upload:hover {
            border-color: var(--color-primary);
            background: rgba(212, 175, 55, 0.05);
        }
        
        .logo-preview {
            margin-top: calc(var(--spacing-unit) * 2);
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-unit) * 2);
            padding: calc(var(--spacing-unit) * 2);
            background: var(--color-bg);
            border-radius: var(--radius-sm);
        }
        
        .logo-preview img {
            max-width: 120px;
            max-height: 80px;
            object-fit: contain;
        }
        
        /* === TEMPLATE SELECTOR === */
        .template-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: calc(var(--spacing-unit) * 2);
        }
        
        .template-card {
            border: 2px solid var(--color-border);
            border-radius: var(--radius-md);
            padding: calc(var(--spacing-unit) * 2);
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }
        
        .template-card:hover {
            border-color: var(--color-primary);
            box-shadow: var(--shadow-md);
        }
        
        .template-card.active {
            border-color: var(--color-primary);
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.1) 0%, rgba(184, 148, 31, 0.1) 100%);
            box-shadow: var(--shadow-md);
        }
        
        .template-card h4 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: calc(var(--spacing-unit) / 2);
        }
        
        .template-card p {
            font-size: 12px;
            color: var(--color-text-light);
        }
        
        /* === DYNAMIC LISTS === */
        .list-item {
            background: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            padding: calc(var(--spacing-unit) * 2);
            margin-bottom: calc(var(--spacing-unit) * 2);
        }
        
        .list-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: calc(var(--spacing-unit) * 1.5);
        }
        
        .list-item-title {
            font-weight: 600;
            font-size: 14px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: calc(var(--spacing-unit) * 1.5);
        }
        
        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: calc(var(--spacing-unit) * 1.5);
        }
        
        /* === TOAST === */
        .toast {
            position: fixed;
            top: calc(var(--spacing-unit) * 3);
            right: calc(var(--spacing-unit) * 3);
            background: var(--color-white);
            padding: calc(var(--spacing-unit) * 2) calc(var(--spacing-unit) * 3);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-unit) * 2);
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.success {
            border-left: 4px solid var(--color-success);
        }
        
        .toast.error {
            border-left: 4px solid var(--color-error);
        }
        
        /* === LOADING OVERLAY === */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .loading-overlay.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .loading-content {
            background: var(--color-white);
            padding: calc(var(--spacing-unit) * 4);
            border-radius: var(--radius-xl);
            text-align: center;
        }
        
        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--color-border);
            border-top-color: var(--color-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto calc(var(--spacing-unit) * 2);
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* === PRINT STYLES === */
        @media print {
            .editor-panel {
                display: none !important;
            }
            
            .preview-container {
                padding: 0;
                background: white;
            }
            
            #previewSheet {
                box-shadow: none;
                max-width: none;
            }
        }
        
        /* === RESPONSIVE === */
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .editor-panel {
                width: 100%;
                height: auto;
                position: relative;
                border-right: none;
                border-bottom: 1px solid var(--color-border);
            }
            
            .preview-container {
                padding: calc(var(--spacing-unit) * 2);
            }
            
            .template-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* === TEMPLATE STYLES === */
        
        /* Apple Minimalist */
        .template-apple {
            font-family: 'Inter', sans-serif;
            padding: calc(var(--spacing-unit) * 8);
            color: #1d1d1f;
        }
        
        .template-apple .header {
            text-align: center;
            margin-bottom: calc(var(--spacing-unit) * 6);
        }
        
        .template-apple .logo {
            max-width: 200px;
            height: auto;
            margin-bottom: calc(var(--spacing-unit) * 3);
        }
        
        .template-apple .brand-name {
            font-size: 48px;
            font-weight: 800;
            letter-spacing: -0.02em;
            margin-bottom: calc(var(--spacing-unit) * 1);
        }
        
        .template-apple .tagline {
            font-size: 18px;
            color: #86868b;
            font-weight: 400;
        }
        
        .template-apple .package-title {
            font-size: 72px;
            font-weight: 800;
            letter-spacing: -0.03em;
            margin: calc(var(--spacing-unit) * 6) 0 calc(var(--spacing-unit) * 2);
            text-align: center;
        }
        
        .template-apple .package-subtitle {
            font-size: 24px;
            color: #86868b;
            text-align: center;
            margin-bottom: calc(var(--spacing-unit) * 8);
        }
        
        .template-apple .section-heading {
            font-size: 36px;
            font-weight: 700;
            margin: calc(var(--spacing-unit) * 6) 0 calc(var(--spacing-unit) * 4);
        }
        
        .template-apple .hotels-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: calc(var(--spacing-unit) * 3);
            margin-bottom: calc(var(--spacing-unit) * 8);
        }
        
        .template-apple .hotel-card {
            background: #f5f5f7;
            border-radius: calc(var(--spacing-unit) * 3);
            overflow: hidden;
            transition: transform 0.3s ease;
        }
        
        .template-apple .hotel-photos {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2px;
            height: 240px;
        }
        
        .template-apple .hotel-photo {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .template-apple .hotel-info {
            padding: calc(var(--spacing-unit) * 3);
        }
        
        .template-apple .hotel-city {
            font-size: 14px;
            color: #86868b;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: calc(var(--spacing-unit) * 1);
        }
        
        .template-apple .hotel-name {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: calc(var(--spacing-unit) * 1);
        }
        
        .template-apple .hotel-stars {
            color: #ffb800;
            margin-bottom: calc(var(--spacing-unit) * 1);
        }
        
        .template-apple .hotel-meta {
            display: flex;
            gap: calc(var(--spacing-unit) * 2);
            font-size: 14px;
            color: #86868b;
        }
        
        .template-apple .prices-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: calc(var(--spacing-unit) * 3);
            margin-bottom: calc(var(--spacing-unit) * 8);
        }
        
        .template-apple .price-card {
            background: #f5f5f7;
            border-radius: calc(var(--spacing-unit) * 3);
            padding: calc(var(--spacing-unit) * 4);
            text-align: center;
        }
        
        .template-apple .price-label {
            font-size: 16px;
            color: #86868b;
            margin-bottom: calc(var(--spacing-unit) * 2);
        }
        
        .template-apple .price-value {
            font-size: 48px;
            font-weight: 800;
            letter-spacing: -0.02em;
        }
        
        .template-apple .services-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: calc(var(--spacing-unit) * 3);
        }
        
        .template-apple .service-card {
            background: #f5f5f7;
            border-radius: calc(var(--spacing-unit) * 3);
            padding: calc(var(--spacing-unit) * 3);
            text-align: center;
        }
        
        .template-apple .service-icon {
            font-size: 48px;
            margin-bottom: calc(var(--spacing-unit) * 2);
        }
        
        .template-apple .service-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: calc(var(--spacing-unit) * 1);
        }
        
        .template-apple .service-desc {
            font-size: 14px;
            color: #86868b;
        }
        
        /* Magazine Editorial */
        .template-magazine {
            font-family: 'Libre Baskerville', serif;
            background: white;
        }
        
        .template-magazine .hero {
            position: relative;
            height: 600px;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: white;
            padding: calc(var(--spacing-unit) * 6);
        }
        
        .template-magazine .hero-content {
            position: relative;
            z-index: 2;
        }
        
        .template-magazine .hero .logo {
            max-width: 180px;
            margin-bottom: calc(var(--spacing-unit) * 3);
            filter: brightness(0) invert(1);
        }
        
        .template-magazine .hero .brand-name {
            font-size: 64px;
            font-weight: 700;
            margin-bottom: calc(var(--spacing-unit) * 2);
            letter-spacing: 0.02em;
        }
        
        .template-magazine .hero .package-title {
            font-size: 56px;
            font-weight: 400;
            font-style: italic;
            margin-bottom: calc(var(--spacing-unit) * 2);
        }
        
        .template-magazine .hero .tagline {
            font-size: 18px;
            font-family: 'Inter', sans-serif;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            opacity: 0.8;
        }
        
        .template-magazine .content {
            max-width: 1200px;
            margin: 0 auto;
            padding: calc(var(--spacing-unit) * 8);
        }
        
        .template-magazine .section-title {
            font-size: 48px;
            font-weight: 700;
            margin: calc(var(--spacing-unit) * 8) 0 calc(var(--spacing-unit) * 6);
            text-align: center;
            position: relative;
        }
        
        .template-magazine .section-title::after {
            content: '';
            display: block;
            width: 100px;
            height: 3px;
            background: var(--color-primary);
            margin: calc(var(--spacing-unit) * 3) auto 0;
        }
        
        .template-magazine .hotel-feature {
            margin-bottom: calc(var(--spacing-unit) * 8);
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: calc(var(--spacing-unit) * 4);
            align-items: center;
        }
        
        .template-magazine .hotel-feature:nth-child(even) {
            direction: rtl;
        }
        
        .template-magazine .hotel-feature:nth-child(even) > * {
            direction: ltr;
        }
        
        .template-magazine .hotel-images {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: calc(var(--spacing-unit) * 2);
        }
        
        .template-magazine .hotel-images img {
            width: 100%;
            height: 250px;
            object-fit: cover;
        }
        
        .template-magazine .hotel-images img:first-child {
            grid-column: 1 / -1;
            height: 350px;
        }
        
        .template-magazine .hotel-details h3 {
            font-size: 36px;
            margin-bottom: calc(var(--spacing-unit) * 2);
        }
        
        .template-magazine .hotel-city-tag {
            font-family: 'Inter', sans-serif;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--color-primary);
            margin-bottom: calc(var(--spacing-unit) * 1);
        }
        
        .template-magazine .hotel-meta-row {
            display: flex;
            gap: calc(var(--spacing-unit) * 3);
            margin: calc(var(--spacing-unit) * 2) 0;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
        }
        
        .template-magazine .prices-showcase {
            background: #f9f9f9;
            padding: calc(var(--spacing-unit) * 8);
            margin: calc(var(--spacing-unit) * 8) calc(var(--spacing-unit) * -8);
        }
        
        .template-magazine .prices-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: calc(var(--spacing-unit) * 4);
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .template-magazine .price-box {
            text-align: center;
            padding: calc(var(--spacing-unit) * 4);
            background: white;
            border: 2px solid #e0e0e0;
        }
        
        .template-magazine .price-box .label {
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: calc(var(--spacing-unit) * 2);
        }
        
        .template-magazine .price-box .value {
            font-size: 42px;
            font-weight: 700;
            color: var(--color-primary);
        }
        
        .template-magazine .services-columns {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: calc(var(--spacing-unit) * 4);
            margin-top: calc(var(--spacing-unit) * 6);
        }
        
        .template-magazine .service-item {
            text-align: center;
        }
        
        .template-magazine .service-item .icon {
            font-size: 56px;
            margin-bottom: calc(var(--spacing-unit) * 2);
        }
        
        .template-magazine .service-item h4 {
            font-size: 20px;
            margin-bottom: calc(var(--spacing-unit) * 1);
        }
        
        .template-magazine .service-item p {
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            color: #666;
        }
        
        /* Brutalist Luxury */
        .template-brutalist {
            font-family: 'Space Grotesk', sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            padding: 0;
        }
        
        .template-brutalist .header-block {
            background: #000;
            border: 8px solid #fff;
            padding: calc(var(--spacing-unit) * 8);
            text-align: center;
            margin: calc(var(--spacing-unit) * 4);
        }
        
        .template-brutalist .logo {
            max-width: 200px;
            margin-bottom: calc(var(--spacing-unit) * 3);
            filter: brightness(0) invert(1);
        }
        
        .template-brutalist .brand-name {
            font-size: 80px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: calc(var(--spacing-unit) * 2);
        }
        
        .template-brutalist .tagline {
            font-size: 16px;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--color-primary);
        }
        
        .template-brutalist .title-block {
            background: var(--color-primary);
            color: #000;
            padding: calc(var(--spacing-unit) * 10) calc(var(--spacing-unit) * 4);
            text-align: center;
            margin: calc(var(--spacing-unit) * 4);
            border: 8px solid #fff;
        }
        
        .template-brutalist .package-title {
            font-size: 96px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.02em;
            line-height: 0.9;
        }
        
        .template-brutalist .package-subtitle {
            font-size: 28px;
            margin-top: calc(var(--spacing-unit) * 3);
            font-weight: 300;
        }
        
        .template-brutalist .content-wrapper {
            padding: calc(var(--spacing-unit) * 4);
        }
        
        .template-brutalist .section-header {
            font-size: 56px;
            font-weight: 700;
            text-transform: uppercase;
            margin: calc(var(--spacing-unit) * 8) 0 calc(var(--spacing-unit) * 4);
            padding-left: calc(var(--spacing-unit) * 2);
            border-left: 8px solid var(--color-primary);
        }
        
        .template-brutalist .hotels-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: calc(var(--spacing-unit) * 4);
        }
        
        .template-brutalist .hotel-block {
            border: 4px solid #fff;
            background: #1a1a1a;
        }
        
        .template-brutalist .hotel-photos-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            height: 280px;
        }
        
        .template-brutalist .hotel-photos-grid img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-right: 2px solid #000;
        }
        
        .template-brutalist .hotel-photos-grid img:last-child {
            border-right: none;
        }
        
        .template-brutalist .hotel-content {
            padding: calc(var(--spacing-unit) * 3);
        }
        
        .template-brutalist .hotel-city-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--color-primary);
            margin-bottom: calc(var(--spacing-unit) * 1);
        }
        
        .template-brutalist .hotel-name {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: calc(var(--spacing-unit) * 2);
        }
        
        .template-brutalist .hotel-stats {
            display: flex;
            gap: calc(var(--spacing-unit) * 3);
            font-size: 14px;
        }
        
        .template-brutalist .stat {
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-unit) * 1);
        }
        
        .template-brutalist .prices-section {
            background: #fff;
            color: #000;
            padding: calc(var(--spacing-unit) * 8) calc(var(--spacing-unit) * 4);
            margin: calc(var(--spacing-unit) * 8) calc(var(--spacing-unit) * 4);
            border: 8px solid #000;
        }
        
        .template-brutalist .prices-section .section-header {
            color: #000;
            border-left-color: #000;
        }
        
        .template-brutalist .prices-flex {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: calc(var(--spacing-unit) * 4);
        }
        
        .template-brutalist .price-block {
            border: 4px solid #000;
            padding: calc(var(--spacing-unit) * 4);
            text-align: center;
            background: var(--color-primary);
        }
        
        .template-brutalist .price-block .label {
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: calc(var(--spacing-unit) * 2);
            font-weight: 700;
        }
        
        .template-brutalist .price-block .value {
            font-size: 56px;
            font-weight: 700;
        }
        
        .template-brutalist .services-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: calc(var(--spacing-unit) * 4);
        }
        
        .template-brutalist .service-block {
            border: 4px solid #fff;
            padding: calc(var(--spacing-unit) * 4);
            background: #1a1a1a;
            text-align: center;
        }
        
        .template-brutalist .service-block .icon {
            font-size: 64px;
            margin-bottom: calc(var(--spacing-unit) * 2);
        }
        
        .template-brutalist .service-block h4 {
            font-size: 24px;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: calc(var(--spacing-unit) * 1);
        }
        
        .template-brutalist .service-block p {
            font-size: 14px;
            opacity: 0.8;
        }
        
        /* Swiss Modern */
        .template-swiss {
            font-family: 'Space Grotesk', sans-serif;
            background: white;
            padding: 0;
        }
        
        .template-swiss .header-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            min-height: 400px;
        }
        
        .template-swiss .header-left {
            background: #000;
            color: #fff;
            padding: calc(var(--spacing-unit) * 6);
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .template-swiss .logo {
            max-width: 160px;
            margin-bottom: calc(var(--spacing-unit) * 4);
            filter: brightness(0) invert(1);
        }
        
        .template-swiss .brand-name {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: calc(var(--spacing-unit) * 1);
        }
        
        .template-swiss .tagline {
            font-size: 14px;
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }
        
        .template-swiss .header-right {
            background: #ff0000;
            color: #fff;
            padding: calc(var(--spacing-unit) * 6);
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .template-swiss .package-title {
            font-size: 84px;
            font-weight: 700;
            line-height: 0.9;
            margin-bottom: calc(var(--spacing-unit) * 2);
        }
        
        .template-swiss .package-subtitle {
            font-size: 20px;
            font-weight: 300;
        }
        
        .template-swiss .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: calc(var(--spacing-unit) * 8);
        }
        
        .template-swiss .section-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: #ff0000;
            margin-bottom: calc(var(--spacing-unit) * 2);
            font-weight: 700;
        }
        
        .template-swiss .section-title {
            font-size: 56px;
            font-weight: 700;
            margin-bottom: calc(var(--spacing-unit) * 6);
            color: #000;
        }
        
        .template-swiss .hotels-list {
            display: grid;
            gap: calc(var(--spacing-unit) * 6);
        }
        
        .template-swiss .hotel-row {
            display: grid;
            grid-template-columns: 2fr 3fr;
            gap: calc(var(--spacing-unit) * 4);
            border-bottom: 2px solid #000;
            padding-bottom: calc(var(--spacing-unit) * 6);
        }
        
        .template-swiss .hotel-info-col h3 {
            font-size: 42px;
            font-weight: 700;
            margin-bottom: calc(var(--spacing-unit) * 2);
        }
        
        .template-swiss .hotel-city-tag {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: #ff0000;
            margin-bottom: calc(var(--spacing-unit) * 1);
            font-weight: 700;
        }
        
        .template-swiss .hotel-meta-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: calc(var(--spacing-unit) * 2);
            margin-top: calc(var(--spacing-unit) * 3);
        }
        
        .template-swiss .meta-item {
            font-size: 14px;
        }
        
        .template-swiss .meta-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #999;
            margin-bottom: calc(var(--spacing-unit) * 0.5);
        }
        
        .template-swiss .meta-value {
            font-weight: 600;
        }
        
        .template-swiss .hotel-images-stack {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: calc(var(--spacing-unit) * 2);
        }
        
        .template-swiss .hotel-images-stack img {
            width: 100%;
            height: 300px;
            object-fit: cover;
        }
        
        .template-swiss .prices-module {
            background: #000;
            color: #fff;
            padding: calc(var(--spacing-unit) * 8);
            margin: calc(var(--spacing-unit) * 8) 0;
        }
        
        .template-swiss .prices-module .section-label {
            color: #ff0000;
        }
        
        .template-swiss .prices-module .section-title {
            color: #fff;
        }
        
        .template-swiss .prices-table {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: calc(var(--spacing-unit) * 3);
        }
        
        .template-swiss .price-cell {
            border: 2px solid #ff0000;
            padding: calc(var(--spacing-unit) * 4);
            text-align: center;
        }
        
        .template-swiss .price-cell .label {
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: calc(var(--spacing-unit) * 2);
        }
        
        .template-swiss .price-cell .value {
            font-size: 48px;
            font-weight: 700;
            color: #ff0000;
        }
        
        .template-swiss .services-matrix {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: calc(var(--spacing-unit) * 3);
        }
        
        .template-swiss .service-cell {
            border: 2px solid #000;
            padding: calc(var(--spacing-unit) * 4);
            text-align: center;
        }
        
        .template-swiss .service-cell .icon {
            font-size: 56px;
            margin-bottom: calc(var(--spacing-unit) * 2);
        }
        
        .template-swiss .service-cell h4 {
            font-size: 18px;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: calc(var(--spacing-unit) * 1);
        }
        
        .template-swiss .service-cell p {
            font-size: 14px;
            color: #666;
        }
        
        /* Additional templates styles would go here (Desert, Kazakh, Ultra, Glass) */
        /* For brevity, I'm including just the structure - you can add the complete CSS from the original */
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Editor Panel -->
        <aside class="editor-panel">
            <div class="editor-header">
                <h1>ATLAS Ultimate</h1>
                <p>Premium Package Generator ‚Äî Fully Editable</p>
            </div>
            
            <div class="editor-content">
                <!-- Branding -->
                <section class="form-section">
                    <h3 class="section-title">–ë—Ä–µ–Ω–¥–∏–Ω–≥</h3>
                    
                    <div class="form-group">
                        <label>–õ–æ–≥–æ—Ç–∏–ø</label>
                        <div class="logo-upload" id="logoUpload">
                            <div>üì∑ –ó–∞–≥—Ä—É–∑–∏—Ç—å –ª–æ–≥–æ—Ç–∏–ø</div>
                            <small style="color: var(--color-text-light); margin-top: 8px; display: block;">JPG, PNG –¥–æ 2MB</small>
                        </div>
                        <input type="file" id="logoInput" accept="image/*" style="display: none;">
                        <div id="logoPreview" style="display: none;" class="logo-preview">
                            <img id="logoPreviewImg" alt="Logo">
                            <button class="btn btn-small btn-delete" id="logoRemove">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ –±—Ä–µ–Ω–¥–∞</label>
                        <input type="text" id="brandName" placeholder="ATLAS">
                    </div>
                    
                    <div class="form-group">
                        <label>–°–ª–æ–≥–∞–Ω</label>
                        <input type="text" id="tagline" placeholder="Premium Travel Services">
                    </div>
                </section>
                
                <!-- Package Info -->
                <section class="form-section">
                    <h3 class="section-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞–∫–µ—Ç–µ</h3>
                    
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–∞</label>
                        <input type="text" id="packageTitle" placeholder="Umrah 2025">
                    </div>
                    
                    <div class="form-group">
                        <label>–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫</label>
                        <input type="text" id="packageSubtitle" placeholder="–°–≤—è—â–µ–Ω–Ω–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ">
                    </div>
                </section>
                
                <!-- Section Headings -->
                <section class="form-section">
                    <h3 class="section-title">–ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ä–∞–∑–¥–µ–ª–æ–≤</h3>
                    
                    <div class="form-group">
                        <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–∞–∑–¥–µ–ª–∞ "–û—Ç–µ–ª–∏"</label>
                        <input type="text" id="hotelsHeading" placeholder="–û—Ç–µ–ª–∏">
                    </div>
                    
                    <div class="form-group">
                        <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–∞–∑–¥–µ–ª–∞ "–¶–µ–Ω—ã"</label>
                        <input type="text" id="pricesHeading" placeholder="–¶–µ–Ω—ã">
                    </div>
                    
                    <div class="form-group">
                        <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–∞–∑–¥–µ–ª–∞ "–£—Å–ª—É–≥–∏"</label>
                        <input type="text" id="servicesHeading" placeholder="–ß—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ">
                    </div>
                </section>
                
                <!-- Template Selector -->
                <section class="form-section">
                    <h3 class="section-title">–®–∞–±–ª–æ–Ω</h3>
                    <div class="template-grid" id="templateSelector">
                        <div class="template-card active" data-template="apple-minimalist">
                            <h4>Apple Minimalist</h4>
                            <p>–ö—Ä—É–ø–Ω–∞—è —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞</p>
                        </div>
                        <div class="template-card" data-template="magazine-editorial">
                            <h4>Magazine Editorial</h4>
                            <p>–ñ—É—Ä–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å—Ç–∫–∞</p>
                        </div>
                        <div class="template-card" data-template="brutalist-luxury">
                            <h4>Brutalist Luxury</h4>
                            <p>–¢—ë–º–Ω–∞—è –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–∞—è</p>
                        </div>
                        <div class="template-card" data-template="swiss-modern">
                            <h4>Swiss Modern</h4>
                            <p>–®–≤–µ–π—Ü–∞—Ä—Å–∫–∞—è —Å–µ—Ç–∫–∞</p>
                        </div>
                    </div>
                </section>
                
                <!-- Hotels -->
                <section class="form-section">
                    <h3 class="section-title">–û—Ç–µ–ª–∏</h3>
                    <div id="hotelsList"></div>
                    <button class="btn btn-secondary btn-small" id="addHotel">+ –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–µ–ª—å</button>
                </section>
                
                <!-- Prices -->
                <section class="form-section">
                    <h3 class="section-title">–¶–µ–Ω—ã</h3>
                    <div id="pricesList"></div>
                    <button class="btn btn-secondary btn-small" id="addPrice">+ –î–æ–±–∞–≤–∏—Ç—å —Ü–µ–Ω—É</button>
                </section>
                
                <!-- Services -->
                <section class="form-section">
                    <h3 class="section-title">–£—Å–ª—É–≥–∏</h3>
                    <div id="servicesList"></div>
                    <button class="btn btn-secondary btn-small" id="addService">+ –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É</button>
                </section>
                
                <!-- Actions -->
                <section class="form-section">
                    <h3 class="section-title">–î–µ–π—Å—Ç–≤–∏—è</h3>
                    <div class="button-group">
                        <button class="btn btn-primary" id="exportPDF">üìÑ –≠–∫—Å–ø–æ—Ä—Ç PDF</button>
                        <button class="btn btn-secondary" id="printBtn">üñ®Ô∏è –ü–µ—á–∞—Ç—å</button>
                    </div>
                    <div class="button-group" style="margin-top: 16px;">
                        <button class="btn btn-secondary btn-small" id="saveJSON">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button class="btn btn-secondary btn-small" id="loadJSON">üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                    </div>
                    <input type="file" id="jsonInput" accept=".json" style="display: none;">
                </section>
            </div>
        </aside>
        
        <!-- Preview Area -->
        <main class="preview-container">
            <div id="previewSheet"></div>
        </main>
    </div>
    
    <!-- Toast -->
    <div id="toast" class="toast"></div>
    
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <h3>–°–æ–∑–¥–∞–Ω–∏–µ PDF...</h3>
            <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ</p>
        </div>
    </div>
    
    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    
    <script>
        // === STATE MANAGEMENT ===
        let state = {
            template: 'apple-minimalist',
            logo: null,
            brandName: 'ATLAS',
            tagline: 'Premium Travel Services',
            packageTitle: 'Umrah 2025',
            packageSubtitle: '–°–≤—è—â–µ–Ω–Ω–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ',
            hotelsHeading: '–û—Ç–µ–ª–∏',
            pricesHeading: '–¶–µ–Ω—ã',
            servicesHeading: '–ß—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ',
            hotels: [
                {
                    city: '–ú–µ–∫–∫–∞',
                    name: 'Swiss√¥tel Makkah',
                    stars: 5,
                    rating: 9.2,
                    distance: '300–º –æ—Ç –•–∞—Ä–∞–º–∞',
                    photos: [
                        'https://images.unsplash.com/photo-1566073771259-6a8506099945?w=800',
                        'https://images.unsplash.com/photo-1582719478250-c89cae4dc85b?w=800',
                        'https://images.unsplash.com/photo-1551882547-ff40c63fe5fa?w=800'
                    ]
                },
                {
                    city: '–ú–µ–¥–∏–Ω–∞',
                    name: 'M√∂venpick Hotel',
                    stars: 5,
                    rating: 9.3,
                    distance: '200–º –æ—Ç –º–µ—á–µ—Ç–∏',
                    photos: [
                        'https://images.unsplash.com/photo-1542314831-068cd1dbfeeb?w=800',
                        'https://images.unsplash.com/photo-1571896349842-33c89424de2d?w=800',
                        'https://images.unsplash.com/photo-1445019980597-93fa8acb246c?w=800'
                    ]
                }
            ],
            prices: [
                { label: '4-–º–µ—Å—Ç–Ω—ã–π', value: '$1,500' },
                { label: '3-–º–µ—Å—Ç–Ω—ã–π', value: '$1,800' },
                { label: '2-–º–µ—Å—Ç–Ω—ã–π', value: '$2,200' }
            ],
            services: [
                { icon: '‚úàÔ∏è', title: '–í–∏–∑–∞', desc: '–ü–æ–ª–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ' },
                { icon: 'üè®', title: '–û—Ç–µ–ª–∏ 5‚òÖ', desc: '–ü—Ä–µ–º–∏—É–º —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ' },
                { icon: 'üöå', title: '–¢—Ä–∞–Ω—Å—Ñ–µ—Ä', desc: '–ö–æ–º—Ñ–æ—Ä—Ç–∞–±–µ–ª—å–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç' },
                { icon: 'üçΩÔ∏è', title: '–ü–∏—Ç–∞–Ω–∏–µ', desc: '–ó–∞–≤—Ç—Ä–∞–∫–∏ –≤–∫–ª—é—á–µ–Ω—ã' },
                { icon: 'üì±', title: '–ü–æ–¥–¥–µ—Ä–∂–∫–∞ 24/7', desc: '–†—É—Å—Å–∫–æ—è–∑—ã—á–Ω—ã–π –≥–∏–¥' },
                { icon: 'üé´', title: '–≠–∫—Å–∫—É—Ä—Å–∏–∏', desc: '–û–±–∑–æ—Ä–Ω—ã–µ —Ç—É—Ä—ã' }
            ]
        };
        
        // === UTILITY FUNCTIONS ===
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        function sanitizeUrl(url) {
            if (!url) return '';
            try {
                new URL(url);
                return url + (url.includes('unsplash') ? '&w=800' : '');
            } catch {
                return '';
            }
        }
        
        function getStars(count) {
            return '‚≠ê'.repeat(count);
        }
        
        // === RENDER TEMPLATES ===
        function renderAppleMinimalist() {
            const hotels = state.hotels.map(hotel => {
                const photoHtml = hotel.photos.slice(0, 3).map(url => 
                    `<img src="${sanitizeUrl(url)}" alt="${hotel.name}" class="hotel-photo" crossorigin="anonymous">`
                ).join('');
                
                return `
                    <div class="hotel-card">
                        <div class="hotel-photos">
                            ${photoHtml || '<div style="background: #e0e0e0; grid-column: 1/-1;"></div>'}
                        </div>
                        <div class="hotel-info">
                            <div class="hotel-city">${hotel.city}</div>
                            <h3 class="hotel-name">${hotel.name}</h3>
                            <div class="hotel-stars">${getStars(hotel.stars)}</div>
                            <div class="hotel-meta">
                                <span>‚≠ê ${hotel.rating}</span>
                                <span>üìç ${hotel.distance}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            const prices = state.prices.map(price => `
                <div class="price-card">
                    <div class="price-label">${price.label}</div>
                    <div class="price-value">${price.value}</div>
                </div>
            `).join('');
            
            const services = state.services.map(service => `
                <div class="service-card">
                    <div class="service-icon">${service.icon}</div>
                    <div class="service-title">${service.title}</div>
                    <div class="service-desc">${service.desc}</div>
                </div>
            `).join('');
            
            return `
                <div class="template-apple">
                    <div class="header">
                        ${state.logo ? `<img src="${state.logo}" alt="Logo" class="logo" crossorigin="anonymous">` : ''}
                        <h1 class="brand-name">${state.brandName}</h1>
                        <p class="tagline">${state.tagline}</p>
                    </div>
                    
                    <h2 class="package-title">${state.packageTitle}</h2>
                    <p class="package-subtitle">${state.packageSubtitle}</p>
                    
                    <h3 class="section-heading">${state.hotelsHeading}</h3>
                    <div class="hotels-grid">${hotels}</div>
                    
                    <h3 class="section-heading">${state.pricesHeading}</h3>
                    <div class="prices-grid">${prices}</div>
                    
                    <h3 class="section-heading">${state.servicesHeading}</h3>
                    <div class="services-grid">${services}</div>
                </div>
            `;
        }
        
        function renderMagazineEditorial() {
            const hotels = state.hotels.map((hotel, idx) => {
                const photoHtml = hotel.photos.slice(0, 3).map((url, i) => 
                    `<img src="${sanitizeUrl(url)}" alt="${hotel.name}" crossorigin="anonymous">`
                ).join('');
                
                return `
                    <div class="hotel-feature">
                        <div class="hotel-images">
                            ${photoHtml || '<div style="background: #ddd; grid-column: 1/-1; height: 350px;"></div>'}
                        </div>
                        <div class="hotel-details">
                            <div class="hotel-city-tag">${hotel.city}</div>
                            <h3>${hotel.name}</h3>
                            <div class="hotel-meta-row">
                                <span>${getStars(hotel.stars)}</span>
                                <span>–†–µ–π—Ç–∏–Ω–≥ ${hotel.rating}/10</span>
                            </div>
                            <p style="margin-top: 16px; font-family: Inter, sans-serif; color: #666;">
                                üìç ${hotel.distance}
                            </p>
                        </div>
                    </div>
                `;
            }).join('');
            
            const prices = state.prices.map(price => `
                <div class="price-box">
                    <div class="label">${price.label}</div>
                    <div class="value">${price.value}</div>
                </div>
            `).join('');
            
            const services = state.services.map(service => `
                <div class="service-item">
                    <div class="icon">${service.icon}</div>
                    <h4>${service.title}</h4>
                    <p>${service.desc}</p>
                </div>
            `).join('');
            
            return `
                <div class="template-magazine">
                    <div class="hero">
                        <div class="hero-content">
                            ${state.logo ? `<img src="${state.logo}" alt="Logo" class="logo" crossorigin="anonymous">` : ''}
                            <h1 class="brand-name">${state.brandName}</h1>
                            <h2 class="package-title">${state.packageTitle}</h2>
                            <p class="tagline">${state.tagline}</p>
                        </div>
                    </div>
                    
                    <div class="content">
                        <h2 class="section-title">${state.hotelsHeading}</h2>
                        ${hotels}
                        
                        <div class="prices-showcase">
                            <h2 class="section-title">${state.pricesHeading}</h2>
                            <div class="prices-row">${prices}</div>
                        </div>
                        
                        <h2 class="section-title">${state.servicesHeading}</h2>
                        <div class="services-columns">${services}</div>
                    </div>
                </div>
            `;
        }
        
        function renderBrutalistLuxury() {
            const hotels = state.hotels.map(hotel => {
                const photoHtml = hotel.photos.slice(0, 3).map(url => 
                    `<img src="${sanitizeUrl(url)}" alt="${hotel.name}" crossorigin="anonymous">`
                ).join('');
                
                return `
                    <div class="hotel-block">
                        <div class="hotel-photos-grid">
                            ${photoHtml || '<div style="background: #333; grid-column: 1/-1;"></div>'}
                        </div>
                        <div class="hotel-content">
                            <div class="hotel-city-label">${hotel.city}</div>
                            <h3 class="hotel-name">${hotel.name}</h3>
                            <div class="hotel-stats">
                                <div class="stat">${getStars(hotel.stars)}</div>
                                <div class="stat">‚≠ê ${hotel.rating}</div>
                                <div class="stat">üìç ${hotel.distance}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            const prices = state.prices.map(price => `
                <div class="price-block">
                    <div class="label">${price.label}</div>
                    <div class="value">${price.value}</div>
                </div>
            `).join('');
            
            const services = state.services.map(service => `
                <div class="service-block">
                    <div class="icon">${service.icon}</div>
                    <h4>${service.title}</h4>
                    <p>${service.desc}</p>
                </div>
            `).join('');
            
            return `
                <div class="template-brutalist">
                    <div class="header-block">
                        ${state.logo ? `<img src="${state.logo}" alt="Logo" class="logo" crossorigin="anonymous">` : ''}
                        <h1 class="brand-name">${state.brandName}</h1>
                        <p class="tagline">${state.tagline}</p>
                    </div>
                    
                    <div class="title-block">
                        <h2 class="package-title">${state.packageTitle}</h2>
                        <p class="package-subtitle">${state.packageSubtitle}</p>
                    </div>
                    
                    <div class="content-wrapper">
                        <h3 class="section-header">${state.hotelsHeading}</h3>
                        <div class="hotels-grid">${hotels}</div>
                        
                        <div class="prices-section">
                            <h3 class="section-header">${state.pricesHeading}</h3>
                            <div class="prices-flex">${prices}</div>
                        </div>
                        
                        <h3 class="section-header">${state.servicesHeading}</h3>
                        <div class="services-grid">${services}</div>
                    </div>
                </div>
            `;
        }
        
        function renderSwissModern() {
            const hotels = state.hotels.map(hotel => {
                const photoHtml = hotel.photos.slice(0, 3).map(url => 
                    `<img src="${sanitizeUrl(url)}" alt="${hotel.name}" crossorigin="anonymous">`
                ).join('');
                
                return `
                    <div class="hotel-row">
                        <div class="hotel-info-col">
                            <div class="hotel-city-tag">${hotel.city}</div>
                            <h3>${hotel.name}</h3>
                            <div class="hotel-meta-grid">
                                <div class="meta-item">
                                    <div class="meta-label">–ó–≤—ë–∑–¥—ã</div>
                                    <div class="meta-value">${getStars(hotel.stars)}</div>
                                </div>
                                <div class="meta-item">
                                    <div class="meta-label">–†–µ–π—Ç–∏–Ω–≥</div>
                                    <div class="meta-value">${hotel.rating}/10</div>
                                </div>
                                <div class="meta-item">
                                    <div class="meta-label">–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ</div>
                                    <div class="meta-value">${hotel.distance}</div>
                                </div>
                            </div>
                        </div>
                        <div class="hotel-images-stack">
                            ${photoHtml || '<div style="background: #ddd; grid-column: 1/-1; height: 300px;"></div>'}
                        </div>
                    </div>
                `;
            }).join('');
            
            const prices = state.prices.map(price => `
                <div class="price-cell">
                    <div class="label">${price.label}</div>
                    <div class="value">${price.value}</div>
                </div>
            `).join('');
            
            const services = state.services.map(service => `
                <div class="service-cell">
                    <div class="icon">${service.icon}</div>
                    <h4>${service.title}</h4>
                    <p>${service.desc}</p>
                </div>
            `).join('');
            
            return `
                <div class="template-swiss">
                    <div class="header-grid">
                        <div class="header-left">
                            ${state.logo ? `<img src="${state.logo}" alt="Logo" class="logo" crossorigin="anonymous">` : ''}
                            <h1 class="brand-name">${state.brandName}</h1>
                            <p class="tagline">${state.tagline}</p>
                        </div>
                        <div class="header-right">
                            <h2 class="package-title">${state.packageTitle}</h2>
                            <p class="package-subtitle">${state.packageSubtitle}</p>
                        </div>
                    </div>
                    
                    <div class="main-content">
                        <div class="section-label">Accommodation</div>
                        <h3 class="section-title">${state.hotelsHeading}</h3>
                        <div class="hotels-list">${hotels}</div>
                        
                        <div class="prices-module">
                            <div class="section-label">Pricing</div>
                            <h3 class="section-title">${state.pricesHeading}</h3>
                            <div class="prices-table">${prices}</div>
                        </div>
                        
                        <div class="section-label">Services</div>
                        <h3 class="section-title">${state.servicesHeading}</h3>
                        <div class="services-matrix">${services}</div>
                    </div>
                </div>
            `;
        }
        
        function render() {
            const sheet = document.getElementById('previewSheet');
            
            switch (state.template) {
                case 'apple-minimalist':
                    sheet.innerHTML = renderAppleMinimalist();
                    break;
                case 'magazine-editorial':
                    sheet.innerHTML = renderMagazineEditorial();
                    break;
                case 'brutalist-luxury':
                    sheet.innerHTML = renderBrutalistLuxury();
                    break;
                case 'swiss-modern':
                    sheet.innerHTML = renderSwissModern();
                    break;
            }
        }
        
        // === EDITOR UI ===
        function renderHotelsList() {
            const list = document.getElementById('hotelsList');
            list.innerHTML = state.hotels.map((hotel, idx) => `
                <div class="list-item">
                    <div class="list-item-header">
                        <span class="list-item-title">–û—Ç–µ–ª—å ${idx + 1}</span>
                        <button class="btn btn-icon btn-delete" onclick="removeHotel(${idx})">üóëÔ∏è</button>
                    </div>
                    <div class="form-group">
                        <label>–ì–æ—Ä–æ–¥</label>
                        <input type="text" value="${hotel.city}" oninput="updateHotel(${idx}, 'city', this.value)">
                    </div>
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                        <input type="text" value="${hotel.name}" oninput="updateHotel(${idx}, 'name', this.value)">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>–ó–≤—ë–∑–¥—ã</label>
                            <input type="number" min="1" max="5" value="${hotel.stars}" oninput="updateHotel(${idx}, 'stars', parseInt(this.value))">
                        </div>
                        <div class="form-group">
                            <label>–†–µ–π—Ç–∏–Ω–≥</label>
                            <input type="number" step="0.1" value="${hotel.rating}" oninput="updateHotel(${idx}, 'rating', parseFloat(this.value))">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ</label>
                        <input type="text" value="${hotel.distance}" oninput="updateHotel(${idx}, 'distance', this.value)">
                    </div>
                    <div class="form-group">
                        <label>–§–æ—Ç–æ 1 (URL)</label>
                        <input type="url" value="${hotel.photos[0] || ''}" oninput="updateHotelPhoto(${idx}, 0, this.value)">
                    </div>
                    <div class="form-group">
                        <label>–§–æ—Ç–æ 2 (URL)</label>
                        <input type="url" value="${hotel.photos[1] || ''}" oninput="updateHotelPhoto(${idx}, 1, this.value)">
                    </div>
                    <div class="form-group">
                        <label>–§–æ—Ç–æ 3 (URL)</label>
                        <input type="url" value="${hotel.photos[2] || ''}" oninput="updateHotelPhoto(${idx}, 2, this.value)">
                    </div>
                </div>
            `).join('');
        }
        
        function renderPricesList() {
            const list = document.getElementById('pricesList');
            list.innerHTML = state.prices.map((price, idx) => `
                <div class="list-item">
                    <div class="list-item-header">
                        <span class="list-item-title">–¶–µ–Ω–∞ ${idx + 1}</span>
                        <button class="btn btn-icon btn-delete" onclick="removePrice(${idx})">üóëÔ∏è</button>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                            <input type="text" value="${price.label}" oninput="updatePrice(${idx}, 'label', this.value)">
                        </div>
                        <div class="form-group">
                            <label>–°—Ç–æ–∏–º–æ—Å—Ç—å</label>
                            <input type="text" value="${price.value}" oninput="updatePrice(${idx}, 'value', this.value)">
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function renderServicesList() {
            const list = document.getElementById('servicesList');
            list.innerHTML = state.services.map((service, idx) => `
                <div class="list-item">
                    <div class="list-item-header">
                        <span class="list-item-title">–£—Å–ª—É–≥–∞ ${idx + 1}</span>
                        <button class="btn btn-icon btn-delete" onclick="removeService(${idx})">üóëÔ∏è</button>
                    </div>
                    <div class="form-group">
                        <label>–ò–∫–æ–Ω–∫–∞ (emoji)</label>
                        <input type="text" value="${service.icon}" oninput="updateService(${idx}, 'icon', this.value)">
                    </div>
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                        <input type="text" value="${service.title}" oninput="updateService(${idx}, 'title', this.value)">
                    </div>
                    <div class="form-group">
                        <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <input type="text" value="${service.desc}" oninput="updateService(${idx}, 'desc', this.value)">
                    </div>
                </div>
            `).join('');
        }
        
        function updateHotel(idx, field, value) {
            state.hotels[idx][field] = value;
            render();
        }
        
        function updateHotelPhoto(idx, photoIdx, value) {
            state.hotels[idx].photos[photoIdx] = value;
            render();
        }
        
        function updatePrice(idx, field, value) {
            state.prices[idx][field] = value;
            render();
        }
        
        function updateService(idx, field, value) {
            state.services[idx][field] = value;
            render();
        }
        
        function removeHotel(idx) {
            state.hotels.splice(idx, 1);
            renderHotelsList();
            render();
        }
        
        function removePrice(idx) {
            state.prices.splice(idx, 1);
            renderPricesList();
            render();
        }
        
        function removeService(idx) {
            state.services.splice(idx, 1);
            renderServicesList();
            render();
        }
        
        // === PDF EXPORT ===
        async function exportSinglePagePDF() {
            const overlay = document.getElementById('loadingOverlay');
            overlay.classList.add('active');
            
            try {
                await document.fonts.ready;
                await new Promise(r => setTimeout(r, 500));
                
                const sheet = document.getElementById('previewSheet');
                const bg = getComputedStyle(sheet).backgroundColor || '#ffffff';
                
                const canvas = await html2canvas(sheet, {
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: bg,
                    logging: false,
                    windowWidth: document.documentElement.scrollWidth
                });
                
                const imgData = canvas.toDataURL('image/jpeg', 0.95);
                const { jsPDF } = window.jspdf;
                
                const pdf = new jsPDF({
                    orientation: 'p',
                    unit: 'px',
                    format: [canvas.width, canvas.height],
                    compress: true,
                    hotfixes: []
                });
                
                pdf.addImage(imgData, 'JPEG', 0, 0, canvas.width, canvas.height, undefined, 'FAST');
                pdf.save(`${state.brandName}_${state.template}_${Date.now()}.pdf`);
                
                showToast('PDF —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!', 'success');
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ PDF —ç–∫—Å–ø–æ—Ä—Ç–∞:', e);
                showToast('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è PDF', 'error');
            } finally {
                overlay.classList.remove('active');
            }
        }
        
        // === EVENT LISTENERS ===
        document.addEventListener('DOMContentLoaded', () => {
            // Branding inputs
            document.getElementById('brandName').addEventListener('input', (e) => {
                state.brandName = e.target.value;
                render();
            });
            
            document.getElementById('tagline').addEventListener('input', (e) => {
                state.tagline = e.target.value;
                render();
            });
            
            document.getElementById('packageTitle').addEventListener('input', (e) => {
                state.packageTitle = e.target.value;
                render();
            });
            
            document.getElementById('packageSubtitle').addEventListener('input', (e) => {
                state.packageSubtitle = e.target.value;
                render();
            });
            
            // Section headings
            document.getElementById('hotelsHeading').addEventListener('input', (e) => {
                state.hotelsHeading = e.target.value;
                render();
            });
            
            document.getElementById('pricesHeading').addEventListener('input', (e) => {
                state.pricesHeading = e.target.value;
                render();
            });
            
            document.getElementById('servicesHeading').addEventListener('input', (e) => {
                state.servicesHeading = e.target.value;
                render();
            });
            
            // Logo upload
            document.getElementById('logoUpload').addEventListener('click', () => {
                document.getElementById('logoInput').click();
            });
            
            document.getElementById('logoInput').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        state.logo = event.target.result;
                        document.getElementById('logoPreview').style.display = 'flex';
                        document.getElementById('logoPreviewImg').src = state.logo;
                        render();
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            document.getElementById('logoRemove').addEventListener('click', () => {
                state.logo = null;
                document.getElementById('logoPreview').style.display = 'none';
                document.getElementById('logoInput').value = '';
                render();
            });
            
            // Template selector
            document.querySelectorAll('.template-card').forEach(card => {
                card.addEventListener('click', () => {
                    document.querySelectorAll('.template-card').forEach(c => c.classList.remove('active'));
                    card.classList.add('active');
                    state.template = card.dataset.template;
                    render();
                });
            });
            
            // Add buttons
            document.getElementById('addHotel').addEventListener('click', () => {
                state.hotels.push({
                    city: '–ù–æ–≤—ã–π –≥–æ—Ä–æ–¥',
                    name: '–ù–æ–≤—ã–π –æ—Ç–µ–ª—å',
                    stars: 5,
                    rating: 9.0,
                    distance: '500–º',
                    photos: ['', '', '']
                });
                renderHotelsList();
                render();
            });
            
            document.getElementById('addPrice').addEventListener('click', () => {
                state.prices.push({ label: '–ù–æ–≤–∞—è —Ü–µ–Ω–∞', value: '$0' });
                renderPricesList();
                render();
            });
            
            document.getElementById('addService').addEventListener('click', () => {
                state.services.push({ icon: 'üéØ', title: '–ù–æ–≤–∞—è —É—Å–ª—É–≥–∞', desc: '–û–ø–∏—Å–∞–Ω–∏–µ' });
                renderServicesList();
                render();
            });
            
            // Actions
            document.getElementById('exportPDF').addEventListener('click', exportSinglePagePDF);
            
            document.getElementById('printBtn').addEventListener('click', () => {
                window.print();
            });
            
            document.getElementById('saveJSON').addEventListener('click', () => {
                const json = JSON.stringify(state, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `atlas_package_${Date.now()}.json`;
                a.click();
                URL.revokeObjectURL(url);
                showToast('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞', 'success');
            });
            
            document.getElementById('loadJSON').addEventListener('click', () => {
                document.getElementById('jsonInput').click();
            });
            
            document.getElementById('jsonInput').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const loaded = JSON.parse(event.target.result);
                            state = { ...state, ...loaded };
                            
                            // Update form fields
                            document.getElementById('brandName').value = state.brandName;
                            document.getElementById('tagline').value = state.tagline;
                            document.getElementById('packageTitle').value = state.packageTitle;
                            document.getElementById('packageSubtitle').value = state.packageSubtitle;
                            document.getElementById('hotelsHeading').value = state.hotelsHeading;
                            document.getElementById('pricesHeading').value = state.pricesHeading;
                            document.getElementById('servicesHeading').value = state.servicesHeading;
                            
                            // Update template
                            document.querySelectorAll('.template-card').forEach(c => c.classList.remove('active'));
                            document.querySelector(`[data-template="${state.template}"]`)?.classList.add('active');
                            
                            // Update logo
                            if (state.logo) {
                                document.getElementById('logoPreview').style.display = 'flex';
                                document.getElementById('logoPreviewImg').src = state.logo;
                            }
                            
                            renderHotelsList();
                            renderPricesList();
                            renderServicesList();
                            render();
                            
                            showToast('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'success');
                        } catch (err) {
                            showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            });
            
            // Initial render
            renderHotelsList();
            renderPricesList();
            renderServicesList();
            render();
        });
    </script>
</body>
</html>